# 项目架构

## 项目初始化

```bash
npm init vite@latest
```

## ESLint配置

### 基础配置

参照ESLint官方网址

```bash
npm install eslint --save-dev

npx eslint --init
```

增加lint指令

```json
"lint": "eslint ./src/**/*.{js,jsx,vue,ts,tsx} --fix",
```

设置vue3校验

```js
module.exports = {
    env: {
        browser: true,
        es2021: true
    },
    extends: [
        'plugin:vue/vue3-strongly-recommended',
        'standard'
    ],
    parserOptions: {
        ecmaVersion: 'latest',
        parser: '@typescript-eslint/parser',
        sourceType: 'module'
    },
    plugins: [
        'vue',
        '@typescript-eslint'
    ],
    rules: {}
}
```

### 编辑器集成

1. 卸载禁用vetur
2. 安装ESLint和volar

ESLint提供了格式化工具，但是需要手段开启

### commit钩子配置

安装

```bash
npx mrm@2 lint-staged
```

修改设置

```json
 {
  "name": "vite-project",
  "private": true,
  "version": "0.0.0",
  "scripts": {
    "dev": "vite",
    "build": "vue-tsc --noEmit && vite build",
    "lint": "eslint ./src/**/*.{js,jsx,vue,ts,tsx} --fix",
    "preview": "vite preview",
    "prepare": "husky install"
  },
  "dependencies": {
    "vue": "^3.2.25"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^5.14.0",
    "@typescript-eslint/parser": "^5.14.0",
    "@vitejs/plugin-vue": "^2.2.0",
    "eslint": "^7.32.0",
    "eslint-config-standard": "^16.0.3",
    "eslint-plugin-import": "^2.25.4",
    "eslint-plugin-node": "^11.1.0",
    "eslint-plugin-promise": "^5.2.0",
    "eslint-plugin-vue": "^8.5.0",
    "husky": "^7.0.4",
    "lint-staged": "^12.3.5",
    "typescript": "^4.5.4",
    "vite": "^2.8.0",
    "vue-tsc": "^0.29.8"
  },
  "lint-staged": {
    "*.{js,jsx,vue,ts,tsx}": [
      "npm run lint",
      "git add"
    ]
  }
}
 ```

### 开发和构建的时候进行验证

安装

```bash
npm install vite-plugin-eslint --save-dev
```

## TS环境

https://cn.vitejs.dev/guide/features.html#typescript

### 类型检查

vite 只进行.ts文件的转义，但是不进行类型检查

编译的时候会进行检查

### 客户端类型

Vite默认的类型定义是写给它的Node.js API的

要将其补充到一个Vite应用的客户端代码环境中，请添加一个d.ts声明文件：

```ts
/// <reference types="vite/client" />
```

同时，你也可以将 vite/client 添加到 tsconfig 中的 compilerOptions.types 下：

```json
{
    "compilerOptions": {
        "types": ["vite/client"]
    }
}
```

### TS支持

https://v3.cn.vuejs.org/guide/typescript-support.html

TypeScript 正确推断 Vue 组件选项中的类型，需要使用 defineComponent 全局方法定义组件

```ts
import { defineComponent } from 'vue'

const Component = defineComponent({
  // 已启用类型推断
})
```

单文件组件

```vue
<script lang="ts">
import { defineComponent } from 'vue'
export default defineComponent({
  // 已启用类型推断
})
</script>
```

TS设置类型就会在使用方法时提示

```ts
const filtered = props.msg.filter(p => p.value) // 会校验string上不存在filter
```

泛型定义数据格式

```ts
const foo = ref<{a: Number, b: string}|null>(null)
foo.value = {
  a: 1, 
  b: '1'
}
```

DOM模板引用

```ts
const title = ref<HTMLHeadElement|null>(null)
```

InstanceType TS的类型工具，获取一个类型, 并且可以设置组件类型

```ts
const helloWorld = ref<InstanceType<typeof HelloWorld>|null>(null)
```

事件类型添加

```ts
const handleChange = (evt: Event) => {
  console.log((evt.target as HTMLInputElement).value)
}
```
